#!/bin/bash

if [[ $EUID -eq 0 ]]; then
   echo "YOU ALMOST BROKE YOU ENTIRE BACKUP SYSTEM!!! DONT RUN AS ROOT" 
   exit 80085
fi

current_date=$(date +"%d-%m-%y-%H-%M")

pacy # Updates pac.txt so that All pacman files are the ones currently in use

backup_scripts # Updates the files in the github repo full of shell scripts and conf with the ones currently in use

echo "Backup started at $current_date"

exclude="--exclude */node_modules"

cd ~/Documents

sudo mount /dev/sda1 /mnt/backup

borg prune --force --force --stats --list --keep-within 2d -d 31 -w 8 -m 12 -y 2 --save-space /mnt/backup

borg create --progress --stats --show-rc --verbose --compression lz4  /mnt/backup::'{hostname}-{now}' ~/Documents

borg compact /mnt/backup

sudo umount /mnt/backup

echo "Backup finished"
